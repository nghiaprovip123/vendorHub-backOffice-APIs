// ======================================================================
// PRISMA CLIENT
// ======================================================================
generator client {
  provider = "prisma-client-js"
}

// ======================================================================
// DATABASE
// ======================================================================
datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

// ======================================================================
// ENUMS
// ======================================================================
enum PricingType {
  FIXED
  HIDDEN
  DYNAMIC
  STAFF_TIERED
  QUOTE_BASED
}

enum CategoryLevel {
  LEVEL_1
  LEVEL_2
}

// ======================================================================
// TENANT (MULTI-TENANT ROOT)
// ======================================================================
model Tenant {
  id        String   @id @map("_id") @default(auto()) @db.ObjectId
  name      String
  slug      String   @unique

  services  Service[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ======================================================================
// USER
// ======================================================================
model User {
  id           String    @id @map("_id") @default(auto()) @db.ObjectId
  email        String    @unique
  password     String
  name         String?
  userName     String?
  phonenumber  String?

  accessToken  String?
  refreshToken String?

  services     Service[] @relation("userServices")
}

// ======================================================================
// SELLER
// ======================================================================
model Seller {
  id        String    @id @map("_id") @default(auto()) @db.ObjectId
  storeName String

  services  Service[] @relation("sellerServices")
}
// ======================================================================
// CATEGORY
// ======================================================================
model Category {
  id            String @id @map("_id") @default(auto()) @db.ObjectId
  name          String? 
  slug          String?
  parentId      String?  @db.ObjectId
  parent        Category? @relation("CategoryTree", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  children      Category[] @relation("CategoryTree")
  level         CategoryLevel
  description   String?
  displayOrder  Int? @default(0)
  createAt      DateTime @default(now())
  services      Service[]
}
// ======================================================================
// SERVICE (CORE DOMAIN)
// ======================================================================
model Service {
  id          String   @id @map("_id") @default(auto()) @db.ObjectId
  tenantId    String?   @db.ObjectId
  tenant      Tenant?   @relation(fields: [tenantId], references: [id])
  userId      String?  @db.ObjectId
  user        User?    @relation("userServices", fields: [userId], references: [id])
  sellerId    String?  @db.ObjectId
  seller      Seller?  @relation("sellerServices", fields: [sellerId], references: [id])
  categoryId  String?   @db.ObjectId
  category    Category? @relation(fields: [categoryId], references: [id])
  name        String?
  description String?
  currency     String? @default("VND")
  displayPrice Boolean? @default(true)
  duration     Int?
  pricing        Float?
  isDeleted      Boolean? @default(false)
  isVisible      Boolean? @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  staff     StaffService[]
  bookings  Booking[]
  @@index([tenantId])
}
// ======================================================================
// STAFF SERVICE
// ======================================================================
model StaffService {
  id              String @id @map("_id") @default(auto()) @db.ObjectId
  
  staffId         String? @db.ObjectId
  staff           Staff? @relation(fields: [staffId], references: [id])
  
  serviceId       String? @db.ObjectId
  service         Service? @relation(fields: [serviceId], references: [id])
  @@unique([staffId, serviceId])
}
// ======================================================================
// STAFF
// ======================================================================
model Staff {
  id                String @id @map("_id") @default(auto()) @db.ObjectId
  fullName          String?
  avatar_url        String?
  timezone          String?
  isActive          Boolean? @default(true)
  isDeleted         Boolean? @default(false)
  services          StaffService[]
  workingHours      WorkingHour[]
  bookings          Booking[]
  createdAt         DateTime? @default(now())  // Added
  updatedAt         DateTime? @updatedAt       // Added
}
// ======================================================================
// WORKING HOUR
// ======================================================================
model WorkingHour {
  id                String @id @map("_id") @default(auto()) @db.ObjectId
  day               String  
  startTime         String
  endTime           String
  createdAt         DateTime @default(now())  // Fixed from createAt
  updatedAt         DateTime @updatedAt       // Fixed from updateAt

  staffId           String @db.ObjectId 
  staff             Staff @relation(fields: [staffId], references: [id], onDelete: Cascade)
}
// ======================================================================
// BOOKING
// ======================================================================
model Booking {
  id                              String @id @map("_id") @default(auto()) @db.ObjectId
  bookingCode                     String?
  
  serviceId                       String? @db.ObjectId
  bookingService                  Service? @relation(fields: [serviceId], references: [id])

  staffId                         String? @db.ObjectId
  bookingStaff                    Staff? @relation(fields: [staffId], references: [id])

  day                             String?
  dayOfWeek                       String?
  startTime                       String?
  endTime                         String?
  customerName                    String?
  customerPhone                   String?
  customerEmail                   String?
  notes                           String?
  status                          String?
  createdAt                       DateTime? @default(now())
  updatedAt                       DateTime? @updatedAt
}